/*copyright 2012 robert w. stewart torontographic.com*/

(function(e){e.fn.parallaxSwipe=function(t){function L(){k(parseInt(i.css(m),10)),T==1&&requestAnimFrame(L)}var n={DECAY:.9,MOUSEDOWN_DECAY:.5,SPEED_SPRING:.5,BOUNCE_SPRING:.08,HORIZ:!0,SNAPDISTANCE:20,DISABLELINKS:!0,LAYER:[]},r=e.extend(n,t),i=this,s=document.getElementById(i.attr("id")),o=i.children(".panel"),u=parseInt(i.parents("div").css("width"),10),a=parseInt(i.parents("div").css("height"),10),f=0,l=0,c=0,h,p,d,v=1,m,g,y,b=!1,w=!1,E=!1,S,x,T=!1;if(r.HORIZ==1){var N=parseInt(o.css("width"),10)*o.length;S=u,m="left",o.css("float","left"),i.css("width",N),y=N}else{var C=parseInt(o.css("height"),10)*o.length;S=a,m="top",o.css("float","none"),i.css("height",C),y=C}i.css(m,0),this.parallaxSwipe.getSize=function(e){return N>""?N:C};var k=function(t){b?f*=r.MOUSEDOWN_DECAY:f*=r.DECAY,b||(t>0?c=-t*r.BOUNCE_SPRING:t+y<S?c=(S-y-t)*r.BOUNCE_SPRING:c=0,d-p<0?(i.css(m,t+Math.ceil(f+c)),r.LAYER.length>0&&e.each(r.LAYER,function(n,r){e("#layer"+(n+1)).css(m,(t+Math.ceil(f+c))/r)})):(i.css(m,t+Math.floor(f+c)),r.LAYER.length>0&&e.each(r.LAYER,function(n,r){e("#layer"+(n+1)).css(m,(t+Math.floor(f+c))/r)})))};window.requestAnimFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(e){window.setTimeout(e,1e3/60)}}();var A=function(){e("a",i).each(function(){e(this).click(function(){if(Math.abs(d-p)>=r.SNAPDISTANCE)return!1})})},O=function(e){b||(E?(e.preventDefault(),e=event.touches[0]):e||(e=window.event),s.setCapture?s.setCapture():(window.addEventListener("mousemove",M,!1),window.addEventListener("mouseup",_,!1)),r.HORIZ==1?(p=d=w==1?e.clientX:e.pageX,h=document.getElementById(i.attr("id")).offsetLeft):(p=d=w==1?e.clientY:e.pageY,h=document.getElementById(i.attr("id")).offsetTop),b=!0,T==0&&(T=!0,requestAnimFrame(L)))},M=function(t){if(b){E?(t.preventDefault(),t=event.touches[0]):t||(t=window.event);if(w==1)var n=m=="left"?t.clientX:t.clientY;else var n=m=="left"?t.pageX:t.pageY;i.css(m,h+(n-p)),r.LAYER.length>0&&e.each(r.LAYER,function(t,r){e("#layer"+(t+1)).css(m,(h+(n-p))/r)}),f+=(n-d)*r.SPEED_SPRING,d=n}},_=function(e){b&&(b=!1,A(),s.setCapture?s.releaseCapture():(window.removeEventListener("mousemove",M,!1),window.removeEventListener("mouseup",_,!1)))};E="ontouchstart"in window,i.bind("mousedown touchstart",function(e){O(e)}),i.bind("mousemove touchmove",function(e){M(e)}),i.bind("mouseup touchend",function(e){_(e)})}})(jQuery)