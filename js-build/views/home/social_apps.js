define(["jquery","underscore","backbone","jqmobile","mobiledetection"],function(e,t,n,r,i){return n.View.extend({el:"#panel_3",animationTime:300,events:{"click .carousel_arrow_left a":"previousSlide","click .carousel_arrow_right a":"nextSlide","click .iphone_content img":"iphoneTap"},showPreview:function(){require(["handlebars","text!"+config.assetPath+"/templates/home/iphone.html"],function(t,n){var r=t.compile(n)({});e("body").append(r),e(".test_iphone_close").bind("click",function(){e(".test_iphone_container").remove(),e(".test_overlay_background").remove()})})},iphoneTap:function(){e("#try_it").click()},fanOut:function(){this.setCurrentSlide(this.$el.find(".apps_carousel_container_inner .current"))},fanIn:function(){var e=this,t=this.$el.find(".apps_carousel_container_inner img"),n={$current:this.$el.find(".apps_carousel_container_inner .current")},r,i=1e3,s=1200;r=n.$current,n.$next=r.next().is("img")?r.next():t.first(),n.$prev=r.prev().is("img")?r.prev():t.last(),n.$nextNext=n.$next.next().is("img")?n.$next.next():t.first(),n.$prevPrev=n.$prev.prev().is("img")?n.$prev.prev():t.last(),n.$next.stop().animate({left:340},i),n.$prev.stop().animate({left:340},i),n.$nextNext.stop().animate({left:340},s),n.$prevPrev.stop().animate({left:340},s)},nextSlide:function(){var e=this.$el.find(".apps_carousel_container_inner .current"),t;return e.next().is("img")?t=e.next():t=this.$el.find(".apps_carousel_container_inner img:first"),this.setCurrentSlide(t),!1},previousSlide:function(){var e=this.$el.find(".apps_carousel_container_inner .current"),t;return e.prev().is("img")?t=e.prev():t=this.$el.find(".apps_carousel_container_inner img:last"),this.setCurrentSlide(t),!1},setCurrentSlide:function(t){var n=this,r=this.$el.find(".apps_carousel_container_inner img"),i=this.$el.find(".iphone_content img"),s={$current:t};s.$next=t.next().is("img")?t.next():r.first(),s.$prev=t.prev().is("img")?t.prev():r.last(),s.$nextNext=s.$next.next().is("img")?s.$next.next():r.first(),s.$prevPrev=s.$prev.prev().is("img")?s.$prev.prev():r.last(),r.each(function(){e(this).removeClass("current"),e(this).index()===s.$current.index()?(e(this).addClass("current").css({"z-index":9}).animate({left:320,top:9,height:440},n.animationTime),i.eq(e(this).index()-2).css({"z-index":9}).animate({left:0})):e(this).index()===s.$next.index()?(e(this).css({"z-index":7}).animate({left:485,top:45,height:383},n.animationTime),i.eq(e(this).index()-2).css({"z-index":8}).animate({left:141})):e(this).index()===s.$prev.index()?(e(this).css({"z-index":7}).animate({left:209,top:45,height:383},n.animationTime),i.eq(e(this).index()-2).css({"z-index":8}).animate({left:-141})):e(this).index()===s.$nextNext.index()?(e(this).css({"z-index":5}).animate({left:664,top:86,height:304},n.animationTime),i.eq(e(this).index()-2).css({"z-index":7})):e(this).index()===s.$prevPrev.index()?(e(this).css({"z-index":5}).animate({left:112,top:86,height:304},n.animationTime),i.eq(e(this).index()-2).css({"z-index":7})):(e(this).css({"z-index":3}).animate({left:340,top:100,height:100},n.animationTime),i.eq(e(this).index()-2).css({"z-index":7}))})},render:function(){var t=this,n=!1;this.setElement(e("#panel_3:last")),this.$el.find("img").each(function(){e(this).bind("swipeleft",function(){t.nextSlide()})}),this.$el.find("img").each(function(){e(this).bind("swiperight",function(){t.previousSlide()})}),e(window).keydown(function(e){config.screen===3&&e.keyCode===37&&t.previousSlide(),config.screen===3&&e.keyCode===39&&t.nextSlide()}),e("body").bind("user_scroll",function(e,r){r.top<3335&&r.bottom>3610&&!n?(t.fanOut(),n=!0):(r.top>3335||r.bottom<3610)&&n&&(t.fanIn(),n=!1)}),e("#try_it").bind("click",function(){return i.any()?!0:(t.showPreview(),!1)}),this.setCurrentSlide(this.$el.find(".apps_carousel_container_inner img:first")),config.screen!==3&&!i.any()&&this.fanIn()}})})